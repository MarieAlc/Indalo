{% extends 'base.html.twig' %}

{% block title %}Historique des t√¢ches{% endblock %}

{% block body %}
<h1>üßæ Historique des t√¢ches de nettoyage</h1>

{% if taches is not empty %}
  {% set grouped = {} %}
  {% for item in taches %}
    {% set date = item.date ? item.date.format('d/m/Y') : 'Date inconnue' %}
    {% set grouped = grouped|merge({ (date): (grouped[date] ?? [])|merge([item]) }) %}
  {% endfor %}

  {% for date, items in grouped %}
    <h3>{{ date }}</h3>
    <table class="table-historique">
      <thead>
        <tr>
          <th>Nom de la t√¢che</th>
          <th>R√©currence</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>{{ item.planNettoyage.nom }}</td>
            <td>{{ item.planNettoyage.reccurence ? item.planNettoyage.reccurence.label : 'Non d√©finie' }}</td>
            <td>‚úÖ Valid√©e par {{ item.utilisateur.nom }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endfor %}
{% else %}
  <p>Aucune t√¢che trouv√©e dans l'historique.</p>
{% endif %}

<a href="{{ path('app_nettoyage') }}">‚Üê Retour au suivi</a>
{% endblock %}
